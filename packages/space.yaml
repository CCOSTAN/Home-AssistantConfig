#-------------------------------------------
#  Space Related Packages
# @CCOSTAN
# Original Repo : https://github.com/CCOSTAN/Home-AssistantConfig
#-------------------------------------------
#------ISS----------------------------------
homeassistant:
  customize:
    binary_sensor.iss:
      icon: mdi:satellite-variant
      friendly_name: ISS Visibility
      emulated_hue_hidden: True
      hidden: False
      homebridge_hidden: true
    sensor.launch_window:
      hidden: False
      icon: mdi:rocket
      friendly_name: Rocket Launch Window
#-------------------------------------------
binary_sensor:
  - platform: iss
    show_on_map: False
#-------------------------------------------

sensor:
  - platform: rest
    resource: https://launchlibrary.net/1.2.2/launch/next/10
    name: launch window
    # if the current timestamp is in the launch window
    # this sensor will return the UTC timestamp of the launch
    value_template: >-
      {%- for launch in value_json.launches %}
        {% if launch.location.id == 16 %}
           {% if strptime(isostart, '%Y%m%dT%H%M%SZ').strftime('%Y-%m-%d') == now().strftime('%Y-%m-%d') %}
              True
           {% endif %}
           {% elif %}
              False
        {% endif %}
      {% endfor %}


automation:
  - alias: Launch Window Approaching
    trigger:
      - platform: state
        entity_id: sensor.launch_window
    condition:
      - condition: template
        value_template: "{{not is_state('sensor.launch_window', '')}}"
    action:
      - wait_template: >-
         {{ is_state('sensor.launch_window', 'True') }}
      - service: notify.ios_carlo_6s
        data:
          message: "Rocket Launch about to happen!"


# This automation was just moved to a macro in the speech_engine.
# It's a random fact now.

# automation:
#   - alias: 'ISS is above us'
#
#     trigger:
#       - platform: state
#         entity_id:
#           - binary_sensor.iss
#         state: 'on'
#         from: 'off'
#
#     action:
#       - service: script.speech_engine
