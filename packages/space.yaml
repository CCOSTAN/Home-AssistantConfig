#-------------------------------------------
#  Space Related Packages
# @CCOSTAN
# Original Repo : https://github.com/CCOSTAN/Home-AssistantConfig
#-------------------------------------------
#------ISS----------------------------------
homeassistant:
  customize:
    binary_sensor.iss:
      icon: mdi:satellite-variant
      friendly_name: ISS Visibility
      emulated_hue_hidden: True
      hidden: False
      homebridge_hidden: true
    sensor.rocket:
      hidden: False
      icon: mdi:rocket
      friendly_name: Rocket Launch
#-------------------------------------------
binary_sensor:
  - platform: iss
    show_on_map: False
#-------------------------------------------
#          {% if today_date == target_date  and day_val.location.id | int == 16 %}
sensor:
  - platform: rest
    resource: https://launchlibrary.net/1.2.2/launch/next/10
    scan_interval: 14400
    name: rocket
    value_template: >-
      {% set rocket_launch_datetime = 0000 %}
      {% for day_val in value_json.launches -%}
        {% set today_date = now().strftime('%B %d') %}
        {% set target_date = day_val.net.split(',')[0] %}
          {% if today_date == target_date %}
            {% set rocket_launch_datetime = day_val.windowstart.split(' ')[3] %}
          {% endif %}
      {% endfor %}
      {{ rocket_launch_datetime }}

# This automation was just moved to a macro in the speech_engine.
# It's a random fact now.

# automation:
#   - alias: 'ISS is above us'
#
#     trigger:
#       - platform: state
#         entity_id:
#           - binary_sensor.iss
#         state: 'on'
#         from: 'off'
#
#     action:
#       - service: script.speech_engine
