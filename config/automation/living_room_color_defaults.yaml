######################################################################
# @CCOSTAN - Follow Me on X
# For more info visit https://www.vcloudinfo.com/click-here
# Original Repo : https://github.com/CCOSTAN/Home-AssistantConfig
# -------------------------------------------------------------------
# Living Room Color Defaults - cool white by day, amber by evening
#  Restores after entry/garage secure and when lights are turned on.
# -------------------------------------------------------------------
# Notes: Returns to defaults after entry points close; keeps prior off states.
######################################################################

- alias: 'Living Room Defaults on Turn-On'
  id: living_room_defaults_on_turn_on
  mode: single
  trigger:
    - platform: state
      entity_id:
        - light.living_room_lights
      from: 'off'
      to: 'on'
  condition:
    - condition: state
      entity_id: group.entry_points
      state: 'off'
    - condition: state
      entity_id: group.garage_doors
      state: 'closed'
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: sun.sun
              state: 'above_horizon'
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.living_room_lights
              data:
                color_temp_kelvin: 5500
                brightness: 255
      default:
        - service: light.turn_on
          target:
            entity_id: light.living_room_lights
          data:
            color_temp_kelvin: 2700
            brightness: 200

- alias: 'Restore Living Room After Entry Secured'
  id: restore_living_room_after_entry_secured
  mode: single
  trigger:
    - platform: state
      entity_id: group.entry_points
      to: 'off'
    - platform: state
      entity_id: group.garage_doors
      to: 'closed'
      for: "00:00:30"
  condition:
    - condition: state
      entity_id: group.entry_points
      state: 'off'
    - condition: state
      entity_id: group.garage_doors
      state: 'closed'
  action:
    - choose:
        - conditions:
            - condition: state
              entity_id: sun.sun
              state: 'above_horizon'
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.living_room_lights
              data:
                color_temp_kelvin: 5500
                brightness: 255
            - service: light.turn_on
              target:
                entity_id: light.living_room_accents
              data:
                color_temp_kelvin: 5500
                brightness: 200
      default:
        - service: light.turn_on
          target:
            entity_id: light.living_room_lights
          data:
            color_temp_kelvin: 2700
            brightness: 200
        - service: light.turn_on
          target:
            entity_id: light.living_room_accents
          data:
            color_temp_kelvin: 2700
            brightness: 170

- alias: 'Living Room Red on Entry/Garage Open'
  id: living_room_red_on_entry_open
  mode: restart
  variables:
    was_off: "{{ is_state('light.living_room_lights', 'off') }}"
    accents_were_off: "{{ is_state('light.living_room_accents', 'off') }}"
  trigger:
    - platform: state
      entity_id: group.entry_points
      to: 'on'
    - platform: state
      entity_id: group.garage_doors
      from: 'closed'
      to: 'open'
      for: "00:00:15"
  action:
    - service: scene.turn_on
      target:
        entity_id: scene.red_living_room
    - wait_for_trigger:
        - platform: state
          entity_id: group.entry_points
          to: 'off'
        - platform: state
          entity_id: group.garage_doors
          to: 'closed'
          for: "00:00:30"
      timeout: "01:00:00"
    - choose:
        - conditions: "{{ was_off }}"
          sequence:
            - service: light.turn_off
              target:
                entity_id: light.living_room_lights
    - choose:
        - conditions: "{{ accents_were_off }}"
          sequence:
            - service: light.turn_off
              target:
                entity_id: light.living_room_accents
