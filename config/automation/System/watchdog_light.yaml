##############################################################################
###  Detect when things are on and forgotten about. Like any Good Watchdog.
##############################################################################

- alias: Automated Light WatchDog!
  id: 57a921ca-6009-46e7-9ba6-699eee6cf733
  trigger:
    - platform: state
      entity_id:
        - light.hallway_lights
        - light.foyer
      to: 'on'
      for: '00:20:00'

#Turn it off!
  action:
    - service: homeassistant.turn_off
      data:
        entity_id: "{{ trigger.entity_id }}"

- alias: Make it Right WatchDog!
  id: ddd4397e-951f-46f2-9362-3bff2caa9cf3
  trigger:
    - platform: homeassistant
      event: start
    - platform: sun
      event: sunrise

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'

#Turn it off!
  action:

    - service: homeassistant.turn_off
      data:
        entity_id:
          - switch.front_landscaping
          - switch.back_landscaping
          - light.outdoor_foyer
          - light.outdoor_sconce_1
          - light.outdoor_sconce_2
          - light.outdoor_sconce_3
          - light.led_garage_large
          - light.led_garage_snip
          - light.led_garage_small
          - light.led_outdoor_den
          - light.outdoor_bathroom
          - light.flood_2
          - light.hallway
          - light.hallway_lights
          - light.foyer

##############################################################################
###  Alert when the Kitchen Accent power is cut and the switches go offline
##############################################################################

- alias: Kitchen Accent Power Reminder
  id: b7c767d3-359f-4db4-9156-bba9e7d90602
  mode: single
  trigger:
    - platform: state
      entity_id:
        - switch.kitchen_accent_1
        - switch.kitchen_accent_2
      to: 'unavailable'
      for: '00:00:30'

  condition:
    - condition: state
      entity_id: group.bed
      state: 'off'
    - condition: template
      value_template: "{{ trigger.from_state is not none and trigger.from_state.state != 'unavailable' }}"

  action:
    - service: notify.alexa_media_kitchen
      data:
        message: "The Kitchen Accent plug was switched off. Please turn it back on."
        data:
          type: announce
    - service: script.notify_engine
      data:
        title: "Kitchen Accent Power"
        value1: "The Kitchen Accent plug was switched off. Please turn it back on."
        who: 'parents'
